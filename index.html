<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>100 Words</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
  <style type="text/css">
    .my-flag { height: 32px; }
    .btn-flag { padding: 2px; }
    .btn-flag-img { height: 18px; }
    .flag-active { opacity: 0.2; }
    .my-col { width: 16%; }
    #my-tab { color: #ef6c00; }
    footer,a { color: #6c757d; }
    .btn:focus { outline: none; box-shadow: none; }
  </style>
</head>
<body onload="init()">
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #37474f;">
      <div class="container-fluid">
        <a class="navbar-brand text-uppercase fw-light" href="./">100 Words</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarToggler">
          <ul class="nav">
            <li class="nav-item">
              <button type="button" class="btn btn-sm btn-outline-dark btn-flag" onclick="toggle('pt')">
                <img id="pt" class="btn-flag-img" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/pt.svg" alt="portuguese" />
              </button>
            </li>
            <li class="nav-item ms-2">
              <button type="button" class="btn btn-sm btn-outline-dark btn-flag" onclick="toggle('en')">
                <img id="en" class="btn-flag-img" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/gb.svg" alt="english" />
              </button>
            </li>
            <li class="nav-item ms-2">
              <button type="button" class="btn btn-sm btn-outline-dark btn-flag" onclick="toggle('es')">
                <img id="es" class="btn-flag-img" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/es.svg" alt="spannish" />
              </button>
            </li>
            <li class="nav-item ms-2">
              <button type="button" class="btn btn-sm btn-outline-dark btn-flag" onclick="toggle('de')">
                <img id="de" class="btn-flag-img" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/de.svg" alt="german" />
              </button>
            </li>
            <li class="nav-item ms-2">
              <button type="button" class="btn btn-sm btn-outline-dark btn-flag" onclick="toggle('ua')">
                <img id="ua" class="btn-flag-img" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/ua.svg" alt="ukranian" />
              </button>
            </li>
            <li class="nav-item ms-2">
              <button type="button" class="btn btn-sm btn-outline-secondary btn-flag" onclick="toggle('jp')">
                <img id="jp" class="btn-flag-img" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/jp.svg" alt="japanese" />
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <main class="table-responsive">
    <table id="my-tab" class="table text-center table-bordered align-middle">
      <thead>
        <tr class="table-muted">
          <th class="my-col pt">
            <img class="img-fluid border my-flag shadow-sm" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/pt.svg"
              alt="Portuguese" title="Portuguese" />
          </th>
          <th class="my-col en">
            <img class="img-fluid border my-flag shadow-sm" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/gb.svg"
              alt="English" title="English" />
          </th>
          <th class="my-col es">
             <img class="img-fluid border my-flag shadow-sm" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/es.svg"
              alt="Spanish" title="Spanish" />
          </th>
          <th class="my-col de">
            <img class="img-fluid border my-flag shadow-sm" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/de.svg"
              alt="German" title="German" />
          </th>
          <th class="my-col ua">
            <img class="img-fluid border my-flag shadow-sm" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/ua.svg"
              alt="Ukranian" title="Ukranian" />
          </th>
          <th class="my-col jp">
            <img class="img-fluid border my-flag shadow-sm" src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/jp.svg"
              alt="Japanese" title="Japanese" />
          </th>
        </tr>
      </thead>
      <tbody id="my-tbody">
      </tbody>
    </table>
  </main>

  <footer>
    <div class="container-fluidv text-center p-2">
      <p>
        <a class="text-secondary" href="https://github.com/nunorc/100words">
          <i class="fab fa-github fa-2x"></i>
        </a>
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
  <script type="text/javascript">
    let LANGS = { pt: true, en: true, es: true, de: true, ua: true, jp: true }

    updateTable = (csv) => {
      const rows = csv.split("\n")
      let tab = document.getElementById("my-tbody"), found = 0

      for (const r in rows) {
        const cols = rows[r].split(",")
        if (cols.length === 6) {
          found += 1
          let tr = tab.insertRow(-1)
          for (const c in cols) {
            const l = cols[c].split(";")
            let td = tr.insertCell()
            td.classList.add(Object.keys(LANGS)[c])
            td.innerHTML = l[0].trim()

            if (l.length > 1) {
              td.innerHTML += '<br /><small class="text-muted">(' + l[1].trim() + ')</small>'
            }
          }
        }
      }

      // tmp
      let tr = tab.insertRow(-1),
          td = tr.insertCell()
      td.colSpan = 6
      td.classList.add('text-muted')
      td.classList.add('p-3')
      td.innerHTML = '<span id="todo" class="lead">' + (100-found) + ' to go ...</span>'

      const l = window.location.search.replace('?', '').split('=')
      if (l[0] === 'langs') {
        const langs = l[1].split(',')
        Object.keys(LANGS).forEach(x => {
          if (!(langs.includes(x.toLowerCase())))
            toggle(x)
        })
      }

    }

    init = () => {
      let els = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      Array.prototype.slice.call(els).map((el) => {
        return new bootstrap.Tooltip(el)
      })

      fetch('data.csv')
        .then(response => response.text())
        .then(csv => updateTable(csv))
    }

    toggle = (lang) => {
      LANGS[lang] = !LANGS[lang]

      document.querySelectorAll('.'+lang).forEach((el) => {
        el.classList.toggle('d-none')
      })

      const w = Math.floor( 100 / Object.values(LANGS).filter(Boolean).length )
      document.querySelectorAll('.my-col').forEach((col) => {
        col.style.width = w + '%'
      })

      document.getElementById(lang).classList.toggle('flag-active')
    }
  </script>
</body>
</html>
